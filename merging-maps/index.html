<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title data-react-helmet="true">max-bittker | Merging Maps</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.65em Arvo,sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:Arvo,sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:2.475rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:2.475rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.65rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.65rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.65rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.65rem;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}ul{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.65rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:1rem;line-height:1.65rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}blockquote{margin-left:1.65rem;margin-right:1.65rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.65rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.65rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}li > ul{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.65rem / 2);}code{font-size:0.85rem;line-height:1.65rem;}kbd{font-size:0.85rem;line-height:1.65rem;}samp{font-size:0.85rem;line-height:1.65rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;-moz-font-feature-settings:tnum;-ms-font-feature-settings:tnum;-webkit-font-feature-settings:tnum;padding-left:1.1rem;padding-right:1.1rem;padding-top:0.825rem;padding-bottom:calc(0.825rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}</style><link href="//fonts.googleapis.com/css?family=Montserrat:700|Arvo:400,400i,700" rel="stylesheet" type="text/css"/><style>.warning{color:#9f6000;background-color:#feefb3;padding:18px}.warning:before{content:"\26A0";margin-right:9px}.rfc-page pre{font-family:inherit}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}svg{zoom:4}circle{fill:#fff}path,polyline{stroke-linejoin:round;stroke-linecap:round;stroke:#fff;stroke-width:1px;fill:none}.less-nav-example ul{margin:0;padding:0;list-style:none}.less-nav-example li{display:inline-block}.less-nav-example a{background:pink;border-radius:3px;display:block;margin-right:6px;padding:3px 9px;text-decoration:none}.the-less-class{text-decoration:underline}.headroom *{color:#382e31!important}body{background:#f4eaed}h1{border-bottom:medium dashed #000}#canvas{position:fixed;z-index:1}a{color:#55e;text-decoration:none}a:link{color:#58c}a:visited{color:#97c}a:hover{color:#55e}a:active{color:#00f}.art-card{width:30%;min-width:300px;margin:auto}@media screen and (max-width:500px){.art-card{width:100%}}.markdown img{max-height:60vh;margin:auto;float:right;display:block;margin:10px}.red{color:#ff0;text-shadow:-1px -1px 0 #00f,1px -1px 0 #0f0,-1px 1px 0 #00f,1px 1px 0 red}.ground{width:100%;height:100%;margin:0}.plate{width:90%;height:60vh;margin:30px auto;display:-webkit-box;display:-ms-flexbox;display:flex;border:30px solid #fff}.plate .paper{height:20%;width:100%}.plate .ground-left{background-color:#fff;width:50%}.plate .ground-left .paper{background-color:#fa9}.plate .ground-left .paper:first-child{opacity:1}.plate .ground-left .paper:nth-child(2){opacity:.8}.plate .ground-left .paper:nth-child(3){opacity:.6}.plate .ground-left .paper:nth-child(4){opacity:.4}.plate .ground-left .paper:nth-child(5){opacity:.2}.plate .ground-left .paper:nth-child(6){opacity:0}.plate .ground-right{background-color:#fff;width:50%}.plate .ground-right .paper,.plate .ground-right .paper:first-child{background-color:#9af}.plate .ground-right .paper:nth-child(2){background-color:#adbbff}.plate .ground-right .paper:nth-child(3){background-color:#c2ccff}.plate .ground-right .paper:nth-child(4){background-color:#d6ddff}.plate .ground-right .paper:nth-child(5){background-color:#ebeeff}.plate .ground-right .paper:nth-child(6){background-color:#fff}.plate-two{width:90%;height:60vh;margin:30px auto;display:-webkit-box;display:-ms-flexbox;display:flex;border:30px solid #fff;overflow:hidden;position:relative}.plate-two .paper{position:absolute;width:50%}.plate-two .ground-left{background-color:#fff;width:50%}.plate-two .ground-left .paper{background-color:#5b83ad;height:100%;opacity:.2}.plate-two .ground-left .paper:first-child{height:100%}.plate-two .ground-left .paper:nth-child(2){height:80%}.plate-two .ground-left .paper:nth-child(3){height:60%}.plate-two .ground-left .paper:nth-child(4){height:40%}.plate-two .ground-left .paper:nth-child(5){height:20%}.plate-two .ground-left .paper:nth-child(6){height:0%}.plate-two .ground-right{background-color:#fff;width:50%;height:100%;right:0}.plate-two .ground-right .paper{background-color:#5b83ad}.plate-two .ground-right .paper:first-child{height:20%;z-index:100;background-color:#5b83ad}.plate-two .ground-right .paper:nth-child(2){height:40%;z-index:80;background-color:#7c9cbd}.plate-two .ground-right .paper:nth-child(3){height:60%;z-index:60;background-color:#9db5ce}.plate-two .ground-right .paper:nth-child(4){height:80%;z-index:40;background-color:#bdcdde}.plate-two .ground-right .paper:nth-child(5){background-color:#dee6ef;height:100%;z-index:20}.plate-two .ground-right .paper:nth-child(6){z-index:10;background-color:#fff}.plate-three{width:90%;height:60vh;margin:30px auto;display:-webkit-box;display:-ms-flexbox;display:flex;border:30px solid #fff;overflow:hidden;position:relative}.plate-three .paper{position:absolute;width:50%}.plate-three .ground-left{background-color:#fff;width:50%}.plate-three .ground-left .paper{height:100%}.plate-three .ground-left .paper .layer{position:absolute;width:100%;background-color:#5b83ad;height:100%;opacity:.2}.plate-three .ground-left .paper:first-child{height:100%}.plate-three .ground-left .paper:nth-child(2){height:80%}.plate-three .ground-left .paper:nth-child(3){height:60%}.plate-three .ground-left .paper:nth-child(4){height:40%}.plate-three .ground-left .paper:nth-child(5){height:20%}.plate-three .ground-left .paper:nth-child(6){height:0%}.plate-three .ground-right{background-color:#fff;width:50%;height:100%;right:0}.plate-three .ground-right .paper{background-color:#5b83ad}.plate-three .ground-right .paper:first-child{height:20%;z-index:100;background-color:#5b83ad}.plate-three .ground-right .paper:nth-child(2){height:40%;z-index:80;background-color:#7c9cbd}.plate-three .ground-right .paper:nth-child(3){height:60%;z-index:60;background-color:#9db5ce}.plate-three .ground-right .paper:nth-child(4){height:80%;z-index:40;background-color:#bdcdde}.plate-three .ground-right .paper:nth-child(5){background-color:#dee6ef;height:100%;z-index:20}.plate-three .ground-right .paper:nth-child(6){z-index:10;background-color:#fff}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="1776018700"><div style="margin-bottom:0.825rem;" class="headroom-wrapper" data-reactid="2"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);transition:background-color 0.3s ease;background:hsl(157.3446918126659,45%,80%);" class="headroom headroom--unfixed" data-reactid="3"><div style="max-width:960px;margin-left:auto;margin-right:auto;padding-top:0;padding:1.65rem 1.2375rem;" data-reactid="4"><a style="color:black;text-decoration:none;" href="/" data-reactid="5">max bittker ∙ </a><a style="color:black;text-decoration:none;" href="/about/" data-reactid="6">about ∙ </a><a style="color:black;text-decoration:none;" href="/art/" data-reactid="7">art ∙ </a><a style="color:black;text-decoration:none;" href="/blog/" data-reactid="8">blog</a><span style="display:block;clear:both;" data-reactid="9"> </span></div></div></div><div style="max-width:960px;margin-left:auto;margin-right:auto;padding:1.65rem 1.2375rem;padding-top:0;" data-reactid="10"><div class="markdown" data-reactid="11"><!-- react-empty: 12 --><h1 data-reactid="13">Merging Maps</h1><div data-reactid="14"><blockquote>
<p>“If I were going to give you a quick summary of what our codebase is like, I’d say it’s procedural code that manipulates maps.” <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
</blockquote>
<p>Maps or <em>“Associative arrays”</em> are a ubiquitous abstraction in software development. They allow us to model data in a flexible form that lends itself to manipulation, inspection, and portability.</p>
<p>If you’re looking, you’ll see maps everywhere – in databases, file systems, serialization formats, object oriented programming languages, and most likely, all over your codebase.</p>
<p>…Except you may not call them “maps” — key value data structures inexplicably have a different name in every single programming language:</p>
<pre><code>{
<span class="hljs-symbol">  Python:</span> <span class="hljs-string">"Dictionary"</span>,
<span class="hljs-symbol">  Javascript:</span> <span class="hljs-string">"Object"</span>,
<span class="hljs-symbol">  Lua:</span> <span class="hljs-string">"Table"</span>,
<span class="hljs-symbol">  PHP:</span> <span class="hljs-string">"Associative Array"</span>,
<span class="hljs-symbol">  Ruby:</span> <span class="hljs-string">"Hash"</span>,
<span class="hljs-symbol">  Java:</span> <span class="hljs-string">"HashMap"</span>,
<span class="hljs-symbol">  Clojure:</span> <span class="hljs-string">"Map"</span>,
<span class="hljs-symbol">  Go:</span> <span class="hljs-string">"... also Map."</span>
}
</code></pre>
<p>It’s not just the names. I’ve found the tradeoffs and ergonomics provided around maps to be a significant point of asymmetry between languages. The idea behind this post is to compare languages “fluency” in map processing through a common operation: merging multiple maps into one.</p>
<h2>Merging Maps?</h2>
<p>Merge is not a primitive operation on key value data structures in the same way that get, set, or enumeration are. That being said, it’s an elementary algorithm that enables elegant representations of practical tasks like collating data, class inheritance, updating centralized state, and overriding defaults. So - what does it mean to me to have first class support for merging maps? Ideally, I’d like to see a single method that’s:</p>
<dl>
<dt>Composable</dt>
<dd>Can you use it as an expression and nest it with other expressions?</dd>
<dt>Variadic</dt>
<dd>Can it merge more than two maps in a single invocation?</dd>
<dt>Extensible</dt>
<dd>Can you customize the value resolution strategy for key collisions?</dd>
<dt>Preserving</dt>
<dd>Does it mutate the original map, or return a new one?</dd>
</dl>
<p>You might read this analysis and feel that it’s meaningless to judge the quality of built-in merge functions, when any sort of merge functionality could be ‘trivially’ implemented, imported, or coaxed out of a slick one-liner.
This is all completely true – but I still hope you’ll find this comparison to be an interesting lens to the priorities and baseline “quality of life” of these languages.</p>
<h3>Javascript:</h3>
<pre><code class="language-javascript">    <span class="hljs-built_in">Object</span>.assign(
      {<span class="hljs-attr">shoulders</span>: <span class="hljs-number">2</span>},
      {<span class="hljs-attr">knees</span>: <span class="hljs-number">2</span>},
      {<span class="hljs-attr">toes</span>: <span class="hljs-number">10</span>}
    )
</code></pre>
<p><strong>composable, variadic, and preserving</strong></p>
<p>Not bad - slightly esoteric invocation <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>, but it accepts any number of maps. The return value is the mutated first argument, but to side-step that, you can pass an empty object literal <strong><code>{}</code></strong> in the first position.</p>
<p>Accepting multiple arguments doesn’t just save you from typing it’s helpful at runtime as well. The <strong><code>...</code></strong> spread operator (or <code>apply</code> function) can be used to merge a dynamic number of objects from an array.</p>
<p>No way to customize merge strategies with this function, you’ll need to defer to a helper library, or drop down to a <code>reduce</code> one-liner.</p>
<p>Worth mentioning that like everything in javascript, there’s a caveat: This was part of the ECMAScript 2015 standard, and isn’t available in all JS environments. <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p>
<h3>Ruby:</h3>
<pre><code class="language-ruby">    mapA.merge(mapB)
    <span class="hljs-comment"># with collision resolution block:</span>
    mapA.merge(mapB){<span class="hljs-params">|key, valA, valB|</span> valA + valB}
</code></pre>
<p><strong>composable, extensible and preserving</strong></p>
<p>There’s also a version <strong><code>merge!</code></strong> with the same api that <em>does</em> mutate the array, which is pretty sweet. In order to merge multiple hashes, you can invoke merge with <code>inject</code> (aka reduce aka fold) like this:</p>
<pre><code class="language-ruby">  [mapA, mapB, mapC].inject({}, <span class="hljs-symbol">:merge</span>)
</code></pre>
<h3>Python:</h3>
<pre><code class="language-python">  dictD = {**dictA, **dictB, **dictC}
</code></pre>
<p><strong>composable, variadic, and preserving</strong></p>
<p>This is quite nice - but only works in python 3.5+, taking advantage of the <strong><code>**</code></strong> “splat” unpacking operator. This makes it incompatible with situations where you have a <em>list</em> of dictionaries to merge, because the same splat operator is also used for spreading lists out into function arguments, and to my knowledge you can’t double splat.</p>
<p>You can merge dictionaries in python 2.7 like so:</p>
<pre><code class="language-python">    dict(dictA.items() + dictB.items())
</code></pre>
<p>but be warned that <em>this one</em> doesn’t work in python 3.</p>
<h3>PHP:</h3>
<pre><code class="language-PHP">    $arrayD = array_merge($arrayA, $arrayB, $arrayC);
</code></pre>
<p><strong>composable, variadic, preserving, and confusing</strong></p>
<p>PHP uses a single data structure for associative and indexed arrays, and so its standard library methods have mixed behavior depending on the type of each key (strings versus numbers). In this case, <code>array_merge</code> will overwrite string key collisions with their “rightmost” occurrence, but <em>renumber</em> numeric keys, similar to an array append in other languages. There’s also the union operator <strong><code>+</code></strong>:</p>
<pre><code class="language-PHP">    $arrayC = $arrayA + $arrayB;
</code></pre>
<p>which takes the <em>leftmost</em> value in cases of string and numeric key collisions, with no renumbering … or you could use <code>array_replace</code>, which takes the <em>rightmost</em> value like <code>array_merge</code>, but doesn’t renumber numeric keys.<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p>
<p>PHP also includes a functionality in its standard library that none of the other languages here do: <strong>deep</strong> merging. <code>array_merge_recursive</code> will recursively call merge on string key collisions. When colliding values aren’t arrays, it wraps them in arrays with the key <code>0</code>, which can then be merged – but this means renumbering/concatenating happens instead of ending up with one value or the other. I’ll only touch on one more function- <code>array_replace_recursive</code>. It operates under the same idea as its sibling <code>array_merge_recursive</code>, allowing you to merge nested arrays, but doesn’t try to coerce and renumbering on collisions, so you won’t find values changing type. <sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup></p>
<p>The way PHP blurs the line between indexed and associative arrays allows for some interesting merging mechanics, but there are also cognitive costs to having so many subtly different operations.</p>
<h3>Clojure:</h3>
<pre><code class="language-clojure">    (<span class="hljs-name"><span class="hljs-builtin-name">merge</span></span> {<span class="hljs-symbol">:a</span> <span class="hljs-number">1</span>} {<span class="hljs-symbol">:a</span> <span class="hljs-number">2</span> <span class="hljs-symbol">:b</span> <span class="hljs-number">3</span>} {<span class="hljs-symbol">:c</span> <span class="hljs-number">4</span>})
    <span class="hljs-comment">;;=&gt; {:a 2, :b 3, :c 4}</span>
    (<span class="hljs-name">merge-with</span> +
      {<span class="hljs-symbol">:a</span> <span class="hljs-number">1</span>  <span class="hljs-symbol">:b</span> <span class="hljs-number">2</span>}
      {<span class="hljs-symbol">:a</span> <span class="hljs-number">9</span>  <span class="hljs-symbol">:b</span> <span class="hljs-number">98</span> <span class="hljs-symbol">:c</span> <span class="hljs-number">0</span>})   
    <span class="hljs-comment">;;=&gt; {:a 10, :b 100, :c 0}</span>
    (<span class="hljs-name">merge-with</span> vector
      {<span class="hljs-symbol">:a</span> <span class="hljs-number">1</span>  <span class="hljs-symbol">:b</span> <span class="hljs-number">2</span>}
      {<span class="hljs-symbol">:a</span> <span class="hljs-number">9</span>  <span class="hljs-symbol">:b</span> <span class="hljs-number">98</span> <span class="hljs-symbol">:c</span> <span class="hljs-number">0</span>})   
    <span class="hljs-comment">;;=&gt;{:a [1 9], :b [2 98], :c 0}</span>
</code></pre>
<p><strong>composable, variadic, extensible, and preserving</strong></p>
<p>Everything in clojure is an expression and so everything is composable - there <em>are</em> no statements. Map literals are often used as an argument syntax for functions with optional named arguments, and merge is a convenient way to override a map of defaults with a map of arguments.</p>
<p>Clojure functions tend to accept many arguments whenever possible, and there are a host of nice patterns like spreading, applying and destructuring to take full advantage of these variadic functions. It’s a language where it’s idiomatic to add a list of numbers by shoving them all into to a single <strong><code>+</code></strong> expression.</p>
<p><code>merge-with</code> accepts a strategy for resolution, similar to ruby’s. The difference is that ruby’s block provides three arguments (key, valueA, valueB), where clojure has a simpler signature - just the values. This is actually a boon in many situations, because it means that you can skip writing an anonymous function and make direct use of existing functions, like <strong><code>+</code></strong> and <strong><code>vector</code></strong> in the example.</p>
<p>There’s one more hidden bonus here - clojure’s maps are backed by an immutable data structure that lets us non-destructively build a new map in less than linear time and memory, by internally pointing to old values where possible. This means otherwise expensive merges can be very cheap!</p>
<h3>Java:</h3>
<pre><code class="language-java">    mapA.putAll(mapB);
</code></pre>
<p><strong>None of the above.</strong>
Because this function is a side effect with no return value, it can’t even be composed with other expressions. However, Java ecosystem leverages interfaces extensively and so it’s common to use other implementations of <strong><code>Map&lt;K,V&gt;</code></strong>, such as Guava’s <code>ImmutableMap</code>. This allows you to take advantage of nicer semantics while interoperating with other functions that expect maps.</p>
<h3>Go:</h3>
<pre><code class="language-go">    <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> b {
        a[k] = v
    }
</code></pre>
<h3>Lua:</h3>
<pre><code class="language-lua">    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(tableB) <span class="hljs-keyword">do</span>
      tableA.<span class="hljs-built_in">insert</span>(k, v)
    <span class="hljs-keyword">end</span>
</code></pre>
<p>Go and Lua have no standard library implementations for merging their maps. Writing things out imperatively gets the job done and doesn’t hide any details, but the simplicity of these languages means you give up conveniences like high level map operations. <sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup></p>
<h3>C:</h3>
<pre><code>    ¯\<span class="hljs-keyword">_</span>(ツ)<span class="hljs-keyword">_</span>/¯
</code></pre>
<p>In C, there’s not even a built-in concept of a map. Either make do with arrays and the fixed-layout struct, import a library, or write your own tree/hash algorithm implementation.</p>
<h3>Thanks for Reading!</h3>
<p>Hopefully you think this miniature rosetta code style tour has been a worthwhile point of comparison. I’m not proficient in all of the languages that I touched on, and while I learned a lot researching this post, it’s far from balanced or perfect. If you feel that your favorite language’s honor has been irreparably damaged by my ignorance, I’d be interested to hear in comments.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a href="https://blog.skyliner.io/fourteen-months-with-clojure-beb8b3e4bf00"><em>Fourteen Months with Clojure</em></a> by Dan McKinley <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>Javascript objects' string keys can be accessed with the dot operator like <code>body.shoulder</code>, so to avoid collisions, the standard library methods are only attached to the Object constructor instead of to the instances <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p>If you need you Object.assign to work across all browsers, you need to polyfill or import a utility library <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn4" class="footnote-item"><p>Had trouble keeping the PHP merging methods straight? There's a great picture <a href="https://softonsofa.com/php-array_merge-vs-array_replace-vs-plus-aka-union/">here.</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn5" class="footnote-item"><p>There are illustrative examples of array_replace_recursive vs array_merge_recursive <a href="https://jontai.me/blog/2011/12/array_merge_recursive-vs-array_replace_recursive/">here:</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn6" class="footnote-item"><p>Most big Go or Lua projects end up pulling in dependencies like <a href="https://github.com/imdario/mergo">mergo</a> or <a href="https://stevedonovan.github.io/Penlight/api/libraries/pl.tablex.html#Merging">penlight tablex</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
</div></div><span style="display:block;clear:both;" data-reactid="15"> </span></div></div></div><script src="/bundle.js?t=1493832327440"></script></body></html>