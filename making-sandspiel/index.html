<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.e056beeb938d361a7bff.css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px;text-align:center}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-href="/component---src-templates-blog-template-js.a60764a7020b2d0554a4.css">body,html{margin:0;padding:0;height:100%}.loom{line-height:0;position:absolute;left:0;top:0;right:0;height:100vh;overflow:hidden;z-index:0;pointer-events:none}.loom-row{width:100%;display:flex;overflow:hidden}.tile{display:inline-block;margin:0;background-color:transparent;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAH0lEQVQYV2NkQAX/GZH4/xkYGBhhAmAOSBJEwDkgAQCCrgQEjpMcPgAAAABJRU5ErkJggg==) repeat}.tile-l{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIElEQVQYV2NkYGD4z8DAwMgABTAGXBAuA1OJLADS9B8AguEEBFr1tu0AAAAASUVORK5CYII=) repeat}.hradio{line-height:0;margin-bottom:1em;display:flex;flex-wrap:wrap;justify-content:space-evenly}.b-wrap{border:1px solid #000;padding:5px;display:inline-block;background-color:#f4eeef;z-index:1}.b-wrap.fill{display:flex;align-items:stretch;width:100%}.pack{margin-right:-1px;margin-bottom:-1px}@media screen and (max-width:500px){.b-wrap{padding:2px}}.index{height:100%;width:100%}.less-nav-example ul{margin:0;padding:0;list-style:none}.less-nav-example li{display:inline-block}.less-nav-example a{background:pink;border-radius:3px;display:block;margin-right:6px;padding:3px 9px;text-decoration:none}.the-less-class{text-decoration:underline}.headroom *{color:#382e31!important}body{background:#f4eeef}pre{border:1px solid #000;border-radius:0!important}h1{border-bottom:dashed #000;margin-top:.2em}#canvas{position:fixed;z-index:1}a{color:#55e;text-decoration:none}a:link{color:#58c}a:visited{color:#97c}a:hover{color:#55e}a:active{color:#00f}.markdown img{max-height:50vh;float:right;display:block;margin:10px}.red{color:#ff0;text-shadow:-1px -1px 0 #00f,1px -1px 0 #0f0,-1px 1px 0 #00f,1px 1px 0 red}.ground{width:100%;height:100%;margin:0}.plate{width:90%;height:60vh;margin:30px auto;display:flex;border:30px solid #fff}.plate .paper{height:20%;width:100%}.plate .ground-left{background-color:#fff;width:50%}.plate .ground-left .paper{background-color:#fa9}.plate .ground-left .paper:first-child{opacity:1}.plate .ground-left .paper:nth-child(2){opacity:.8}.plate .ground-left .paper:nth-child(3){opacity:.6}.plate .ground-left .paper:nth-child(4){opacity:.4}.plate .ground-left .paper:nth-child(5){opacity:.2}.plate .ground-left .paper:nth-child(6){opacity:0}.plate .ground-right{background-color:#fff;width:50%}.plate .ground-right .paper,.plate .ground-right .paper:first-child{background-color:#9af}.plate .ground-right .paper:nth-child(2){background-color:#adbbff}.plate .ground-right .paper:nth-child(3){background-color:#c2ccff}.plate .ground-right .paper:nth-child(4){background-color:#d6ddff}.plate .ground-right .paper:nth-child(5){background-color:#ebeeff}.plate .ground-right .paper:nth-child(6){background-color:#fff}.plate-two{width:90%;height:60vh;margin:30px auto;display:flex;border:30px solid #fff;overflow:hidden;position:relative}.plate-two .paper{position:absolute;width:50%}.plate-two .ground-left{background-color:#fff;width:50%}.plate-two .ground-left .paper{background-color:#5b83ad;height:100%;opacity:.2}.plate-two .ground-left .paper:first-child{height:100%}.plate-two .ground-left .paper:nth-child(2){height:80%}.plate-two .ground-left .paper:nth-child(3){height:60%}.plate-two .ground-left .paper:nth-child(4){height:40%}.plate-two .ground-left .paper:nth-child(5){height:20%}.plate-two .ground-left .paper:nth-child(6){height:0%}.plate-two .ground-right{background-color:#fff;width:50%;height:100%;right:0}.plate-two .ground-right .paper{background-color:#5b83ad}.plate-two .ground-right .paper:first-child{height:20%;z-index:100;background-color:#5b83ad}.plate-two .ground-right .paper:nth-child(2){height:40%;z-index:80;background-color:#7c9cbd}.plate-two .ground-right .paper:nth-child(3){height:60%;z-index:60;background-color:#9db5ce}.plate-two .ground-right .paper:nth-child(4){height:80%;z-index:40;background-color:#bdcdde}.plate-two .ground-right .paper:nth-child(5){background-color:#dee6ef;height:100%;z-index:20}.plate-two .ground-right .paper:nth-child(6){z-index:10;background-color:#fff}.plate-three{width:90%;height:60vh;margin:30px auto;display:flex;border:30px solid #fff;overflow:hidden;position:relative}.plate-three .paper{position:absolute;width:50%}.plate-three .ground-left{background-color:#fff;width:50%}.plate-three .ground-left .paper{height:100%}.plate-three .ground-left .paper .layer{position:absolute;width:100%;background-color:#5b83ad;height:100%;opacity:.2}.plate-three .ground-left .paper:first-child{height:100%}.plate-three .ground-left .paper:nth-child(2){height:80%}.plate-three .ground-left .paper:nth-child(3){height:60%}.plate-three .ground-left .paper:nth-child(4){height:40%}.plate-three .ground-left .paper:nth-child(5){height:20%}.plate-three .ground-left .paper:nth-child(6){height:0%}.plate-three .ground-right{background-color:#fff;width:50%;height:100%;right:0}.plate-three .ground-right .paper{background-color:#5b83ad}.plate-three .ground-right .paper:first-child{height:20%;z-index:100;background-color:#5b83ad}.plate-three .ground-right .paper:nth-child(2){height:40%;z-index:80;background-color:#7c9cbd}.plate-three .ground-right .paper:nth-child(3){height:60%;z-index:60;background-color:#9db5ce}.plate-three .ground-right .paper:nth-child(4){height:80%;z-index:40;background-color:#bdcdde}.plate-three .ground-right .paper:nth-child(5){background-color:#dee6ef;height:100%;z-index:20}.plate-three .ground-right .paper:nth-child(6){z-index:10;background-color:#fff}.art-masonry{display:flex;flex-wrap:wrap}@media screen and (max-width:500px){.art-masonry{margin:0 -2em}}.art-card{border:2px solid #f4eaed;overflow:hidden;box-sizing:content-box;width:290px;height:290px}.art-card img{margin:0}.ipost{overflow:hidden}.ipost div{margin-top:-55px}@media screen and (max-width:500px){.art-card{width:100%;height:90vw}}.rc-scout{display:none!important}.rc-scout.rc-scout-react{display:block!important}.canvas{image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;-ms-interpolation-mode:nearest-neighbor;image-rendering:pixelated}</style><meta name="generator" content="Gatsby 2.0.85"/><title data-react-helmet="true">Making Sandspiel (wip dont share pls) | max-bittker</title><meta data-react-helmet="true" name="description" content="Max&#x27;s website"/><script data-react-helmet="true" defer="" src="//www.instagram.com/embed.js"></script><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.65 'Arvo',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Arvo',sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}ul{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.65rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:1rem;line-height:1.65rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}blockquote{margin-left:1.65rem;margin-right:1.65rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.65rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.65rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}li > ul{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.65rem / 2);}code{font-size:0.85rem;line-height:1.65rem;}kbd{font-size:0.85rem;line-height:1.65rem;}samp{font-size:0.85rem;line-height:1.65rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.1rem;padding-right:1.1rem;padding-top:0.825rem;padding-bottom:calc(0.825rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}</style><link href="//fonts.googleapis.com/css?family=Montserrat:700|Arvo:400,400i,700" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-ba78a60d3db701b00030.js"/><link as="script" rel="preload" href="/app-d09068d80534b84825a4.js"/><link as="script" rel="preload" href="/webpack-runtime-109b3e4f4849cb0c05d9.js"/><link as="fetch" rel="preload" href="/static/d/490/path---making-sandspiel-593-364-6J2jAgzFrUXlzycEQ7B8mrIdJZ8.json" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div class="b-wrap fill" style="min-height:100vh"><div class="b-wrap fill"><div class="b-wrap fill"><div class="b-wrap fill"><div class="b-wrap fill"><div class="b-wrap fill"><div style="width:100%"><div><div class="b-wrap pack"><div class="b-wrap"><div class="b-wrap"><div class="b-wrap"><a style="color:black;text-decoration:none;padding:0px  3px" href="/">max bittker</a></div></div></div></div><div class="b-wrap pack"><div class="b-wrap"><div class="b-wrap"><div class="b-wrap"><a style="color:black;text-decoration:none;padding:0px  3px" href="/about/">about</a></div></div></div></div><div class="b-wrap pack"><div class="b-wrap"><div class="b-wrap"><div class="b-wrap"><a style="color:black;text-decoration:none;padding:0px  3px" href="/projects/">projects</a></div></div></div></div><div class="b-wrap pack"><div class="b-wrap"><div class="b-wrap"><div class="b-wrap"><a style="color:black;text-decoration:none;padding:0px  3px" href="/games/">games</a></div></div></div></div><div class="b-wrap pack"><div class="b-wrap"><div class="b-wrap"><div class="b-wrap"><a style="color:black;text-decoration:none;padding:0px  3px" href="/art/">art</a></div></div></div></div><div class="b-wrap pack"><div class="b-wrap"><div class="b-wrap"><div class="b-wrap"><a style="color:black;text-decoration:none;padding:0px  3px" href="/blog/">blog</a></div></div></div></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div><h1>Making Sandspiel (wip dont share pls)</h1><p style="font-size:0.85028rem;line-height:1.65rem;display:block;margin-bottom:1.65rem;margin-top:-1.65rem">January 06, 2019</p><div><p><a href="https://sandspiel.club">Sandspiel</a> is a falling sand game I built in late 2018. I really enjoyed writing this game, and wanted to put into writing some of my goals, design decisions, and experiences from that process.</p>
<p><img src="https://raw.githubusercontent.com/MaxBittker/sandspiel/master/Screenshot.png" alt="screenshot"></p>
<h2>I love falling sand games.</h2>
<p>If you haven’t played a falling sand game before, imagine a pixelated chemistry kit. You’re given a palette of virtual solids, liquids, and gasses, and it’s up to you to paint them onto the screen and discover how they interact.</p>
<p><img src="/fsg-d7b85169861f541f032471a791afdc52.gif" alt="fsg"></p>
<p>I think one reason I love these games so much because their mode of play is creative in a way that activates many parts of your imagination. Playing with the elements means asking questions, building experiments, and inventing your own stories and games.</p>
<blockquote>
<p>“What does fungus do?”</p>
</blockquote>
<blockquote>
<p>“Let’s make a cool volcanic island!”</p>
</blockquote>
<blockquote>
<p>“Does anything destroy lava?”</p>
</blockquote>
<blockquote>
<p>“What happens if I do <em>this</em>?”</p>
</blockquote>
<p>The behavior of any single element is simple, but the resulting system is rich for exploration because of the many ways that elements can interact in different combinations and configurations.</p>
<p>The simulation is engaging not only for their complexity, but because of the ways your imagination sees reality reflected in it. Pouring some yellow pixels onto green ones can invoke a scene in your mind far more vivid than what happens on the screen.</p>
<blockquote>
<p>“Low-fidelity art is also appealingly open to interpretation. If a character is only eight pixels tall, a large part of what we see is within our own imagination.” - Loren Schmidt</p>
</blockquote>
<figure>
<img src="/bitsy-71ee45e7b2f42e7c8b7b215644917868.gif">
  <figcaption><a href="https://candle.itch.io/flotsam"><i>flotsam</i> by mark wonnacott</a><a></a></figcaption><a>
</a></figure>
<h3>Microcommunity</h3>
<p>People love to opine on their forgotten, weird corners of the internet, and mine is the upload gallery of dan-ball.jp’s Powder Game around 2007-2013. There was a beautiful micro-culture of people making games, toys, science demonstrations, propaganda, and art for each other another to load and enjoy.</p>
<p>Powder Game’s upload galleries were beautiful place — the venue to easily build something and share it led to people inspiring each other, riffing, and flexing the game in incredible directions! Sand games had so much staying power through my childhood in large part because of this weird community.</p>
<p>It’s also important that this system was built right into the game — every player had a immediate audience for their creation, versus a culture of a few famous youtubers or streamers, or even the sort of self-selecting culture you find on forums. There was a wide variety of complexity and motivations among posters. All with no comment section!</p>
<p>Three archetypes of upload I remember fondly:</p>
<p>Games for the player, often with empty promises of some reward for voting.
<span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 400px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADIUlEQVQ4y2VUyW4bRxDt2URyhrPvM5zVEhkuIkUKdhQHSBAZjoHA90A8JLCjQ3IIEFknHSSZWhgLBvwV+YF84UtNUxZk5FCo6unGq/de1zSr6xqObcFzXQRRgp++n+PwYIySvu/tjTCbjTCZDDAe9zGdDjEc7vBo9ra3K17PZkNEUYCqqsCiMIChbkGSJDCpjT9/3sfp8hmkloYndYIgsNHrBSiKiEe7rYAxBlEUeH5cW5YFlucZNK1NCwNxHCJN9xCFNXX0kecRsiykzimviyKmOkFZJjw367pO0e8X9+semOtmEFhMHTSoaguHz/9Fkf0B0xSwvz8hqTVGowq7u08wGBQ4+HoXi72vMJvu0P4Q8/kAT5+OKPfJmj4xLGpouksMPYRxgLL6kdjNkCQBsUq5N700RtHrIYp9OKEJ09cRJC5XlFAEgUe2xMR0BywLY9hyBy1FgWp0cTc5wq/FdxC6LSiSTP5IG69EBqNrYu7NsXAXGLsTKPd+yrLMs+/7xDBKkWzZ6ChtGKaJf579hV/KH8BUGRIT+cHYiPHafY0T7QS38i2u5WuslTWW3hKyIj9cjuM4xDDL0FHb0A0DQRhimyREngu72WwOygxH4RE+sU9YsRWP9+w9LtgF7rbuMPWnD4AujR6LggBdSeRj01z7clhjaOtod/WNnC0ZJ+4JB7oQL3Bqn+KsdYZLdom1uMYL9wWY8Agwz3OomsbBmg+Hz7/BtwcH6OobQIW8bUBu2S3Peqjj2D3GNSPZwhovrZfc3wfARnIURTBIskCdVqu/8dvx7/cDK3KP3lnvcMWucNY5wxvrDS7FS5yzc3wQPuCV8+pLhs2v53keZxjHMc3XLg1rRWv7wcNluMRH9pHLvGE33L+mwaq9QmmXX3pY5AW/7larhUZ+VdY09fVmBO4Pxk6Mt8FbXHWucNO55jd9bp5j4Sw2SgTxkeQyJlkSOh0VcerDT3W45JNFD8ZnwM+RBT2MA3os9Al0Vf/fPv+XB5MKYW4iyhzU/QxJZSMpbXptMriOS10deok8XuumDs3UoFkaTMuE53icVRMNWGPff/sinI7KlnBWAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="mood ring"
        title=""
        src="/static/a97befdd69cd9113481230a1204cf22b/8b3d4/moodring.png"
        srcset="/static/a97befdd69cd9113481230a1204cf22b/91f87/moodring.png 148w,
/static/a97befdd69cd9113481230a1204cf22b/8335d/moodring.png 295w,
/static/a97befdd69cd9113481230a1204cf22b/8b3d4/moodring.png 400w"
        sizes="(max-width: 400px) 100vw, 400px"
      />
  </span></p>
<p>Grotesque “Don’t Smoke” educational demonstrations. (I think these were directly fueled by children coming home after D.A.R.E. programs at school)
<span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 400px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADo0lEQVQ4y1WU208cZRjGv92Z2QOwszu7s7O7rFv2DLscWm2hAVrAAhKqoo0ipwJCiTRKbaIxUWuDeKi1QatpUHthSIFiJFa98xCbemFsmhpbja2mRq+884/4+c1s28SLJ++b+d55vuc9faKplCObDJNNRclJRM0Ieih8FyEjTPC2b4RNwpGItBH5PeJ8D9rn0q/RQ6QzWURjxiQTFqQjLpqTbpIhgVktSAYrMPwCKyBIGQLdI/C6K9aOSegux8aljUqbiocROwoxsqabfEyjIFGMV2z+tp82VfKWSsDnprUpw9yju+lvL6GqKqok96guCTeKSzjZiXLGctTZJPbPNrZFFAc2kU2ckqq3N+a4sjrP7+szXF+d4c2FhwgEAqiSqMrrRpM2lTARzTmLbYaLTFSVpCr1cfWuqqL0S7VehBAM9rfz15dHubzyBFc+HOXvT59iZqiNclzQW66it6TR2RRHFOuiTt1iuiLhJiuJk4ZCbUghZSpkLLdDODnUya3NQ/y5Ocut8zPc3JijT6bemBC0Zn10FzVa8hZidznGQKOHjryXwWY/+0o+eaMMaPByX8xPVzZKJl7DnrYyLx3ez9GRThYk3nnuALsKIbqKHvbW+2m5R2FgZwJxb9GiLaOyM+1lb1GS1HloTXvYXqeR9fvYrgfRPAp6jZ9HBjo4tzTKg907GB7sxKjWcEn1fk04tUzGZQ1N2Rm/WimsRxGymy4H1V4JOTJVPuF00E5bCIUX5/bz9HAnR8Z66G6txzRNgrrunBtyHkU6aVKwKk2xm1Cu1WhIaOQsuyGaM1LJmMHS4QHWlx7nquzwwYfbODbXyx+bc9xYm+E1eWYT2uKEvQmV2/8PW+0dP5mw+G1tmssfzHLjwDK/7nuLmz3L/HDoGNfWD7K2OOzEhcOSq1oPM9Lq45WhEKmwwrP9AfYUvCz0BWhJeZzAVNxia3mUiy8/A7s+4d++s9Bxnn8eOMO3K1N8/vY4itstUzYQqdooJx7TeXcswnFJujEf5YXBILNdAfqbqiqEUuHWqTG+f32en0fe4MLiLJeOPM/VJxe5uDLN1olRVEUS2gqjEYOegpv2nFw5OXP2zt7foNEnB/VOygkrzGcnJ+SGTPLT2hi/rI5z7dw41zfG+fHsNBdOjjlxejCIyMgXQvMHqZKp2+nXSPhqDLzVBhH5sujBEKX6PB8dn+Cr01N89/4UX5+e5Jv3prh0Zoovlqf5+NUJrKh8ZDIZ/gMzS9YGbvPrvwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="dont smoke"
        title=""
        src="/static/52dc5bb5dc836b38c7b433c55c6e2da4/8b3d4/dontsmoke3.png"
        srcset="/static/52dc5bb5dc836b38c7b433c55c6e2da4/91f87/dontsmoke3.png 148w,
/static/52dc5bb5dc836b38c7b433c55c6e2da4/8335d/dontsmoke3.png 295w,
/static/52dc5bb5dc836b38c7b433c55c6e2da4/8b3d4/dontsmoke3.png 400w"
        sizes="(max-width: 400px) 100vw, 400px"
      />
  </span></p>
<p>Cool volcanos. (a real classic)
<span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 401px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 74.3142144638404%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdElEQVQoz21Sa0/aYBRugZYCttwRBHqRXriEVies0TEGy3Ru7sO+uPDBeFmiEIWpMFi4OBDdZhY39nFkfjBZ+J87pY7p4pPm7dPTc87zvOd9EeQ+GI3GYDAYiURYlg2P4ff7URTV/+ovi9mEeL1ej8djt9t14nQ6KYoKBALxeDyZTMZisWg0KssydIGgZwyf1+t2e3xuB8IwjJ4kCAIkAeF5HkgikRBFUZIkKAYCQUVRwAvHcWCKYTmGnkFA0+12g6zPBx29DofD5XIBh9Xl1EBSFCSA7PT0tMlk0myjf23fC317JEkWCgVQnkR0ovObYv0DRG5PxYRhG29efz3vlve2LRarHsRxHDwTBPG/smGMMdHqF9XU1ad37cbRoHs4ryT1BGgNB3FHeTL9iQuLjWyWt676xVaj9uNkv1srBmaCk7//jkqvQG5tCdZ89tGvs/LP7m77w/GgXbz+XD7c27SR9ps9T4pRg4FAUcvYrdGo2Q6FQt9PKsNe8byx32m3eo3KoL0HvXa3CiYMh0oMRXAUtU+ZtR48F1lMpXVlwmJ7u7E+7B/066WjaqNer1cbzdb7ytXHnW+dcphhtdEaDBRkgnIsxhRLO6fdeixs5Vi6eVQaXdZGFwfDs0q/2+kDTnuD0+rvL+XRZfW4tEnZSRRDMunIxeFL5NWLTP7JwtPHSl4V1PSD1fziSja9mn34LJNazsxvr82t5ebySwvPs+pKVl3Oqom4lJBCuaXk9noOgVt6+w5MgGM4geEwUJvZTODmu1dIW6esZmRBlnmaFjlOZBmBZUWOlWaBs3JUUhVFlqTxI/IMA0FI4BlaYOjZMK1EhT8/MHpD5Z8nyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="volcano"
        title=""
        src="/static/2e96b5d3aa5192f9da49c0f93a9b8f41/35355/volcano.png"
        srcset="/static/2e96b5d3aa5192f9da49c0f93a9b8f41/9f30b/volcano.png 148w,
/static/2e96b5d3aa5192f9da49c0f93a9b8f41/d321c/volcano.png 295w,
/static/2e96b5d3aa5192f9da49c0f93a9b8f41/35355/volcano.png 401w"
        sizes="(max-width: 401px) 100vw, 401px"
      />
  </span></p>
<p>Beautiful pixel-art architecture to destroy.
<span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 400px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADUElEQVQ4y32T/09VZRzHz0VYMJX7/fLlXiaBcnMsHJQKKLC5SL0ERXC/c7+ccy50u6M7fxCGSpkioCWK0ryzkK5CLNI55+KHVmu4xdasaFqttbY23Wr+Af3UD7167j2saDJ/eO/57Dyf8zrv9/N5juR0OrHZbBQVFVFcXExJSUm2NplM2KwWrBYLJrMZ86osFjNGowlnhQN3ay0GoxG9wYjBYODpigqkqqoqysvLs6CysjKsVisFBQVIkvREmQufYqxvLzu32bCbN2rPhAmpuroau92elcPhEC5M2c2cHB3+F7az51nHv5CaShu7t5dSt62Ijj2VDPp3MpFo4WhPPaf6mqlxbtGAmagZWH5+Pnl5eeTodFnA1eE2Ep21WPQFbCku5FionoWTnaQOH+D7tMIX57q4M+Vh/LW9LF/y8kyl+HjmvHQCkAGtjVRpN3BztIN4Rw2zb7VzOLCLxCs7uD7SzlDPLj6b9PLzvMpPH8W4P6dy930fW8vtSJnDXwvasEFzp7Tv4NGnSd7ormN6oJXrb77EWRErfWQ/J5RGli508+2Un8XRLpYnfSxfdGvAzOTWA74uoj5a7GdEbmTx+MvcmfCx9I6Hr9/zc/HQPj6f8PDDtMx3H0S4P6Pw5XnPk4GJV2t5cDPOrbFO7l1T+XFWFlKEVAZ8dXxz2cvDG1F+nQ/y4IbKyrSPshLL48DcVWBcOPzjdoKJ5IukhiPc+1BhJa1kwXMnupg61sPC+UFup05ybVRh+niApsbdjwN1Om09HW/mt4U+vrrkZmnew8onAX6Zk3m4EGbmlIqrM8BmYykb9aXsa3URlmOoqroWqFuVBjwz1MLdW8LFuypTp4OkxkPMjCikhZsjSRmfPyiul9bb5jpIb0wlHA6LKZsL1/0Txofrmb0awheQs/IHZbzBKN5AhHBEJhj0s2mTWdxdEy4BVNUYkUgEyWJ0CoCF3NxCIb0YymZyJD3nBl0cHegVL4ZR5AjyWkVl4caHorxNb+8FQiE30aiiAZ/f30Jdw8c0N/1NU9OfNDT8RduB3xkbOiQawqIxuo4yQC+JxCTJ5JyoNWBmT/IknsMd6iYUuEzAn8LrvYKqnCGmZqJFsk2R1fW/WgPG42fp70//z+E/NCgmsR3KGeIAAAAASUVORK5CYII='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="castle"
        title=""
        src="/static/bc5412ec2cb771ce209bb170d2cd159d/8b3d4/castle.png"
        srcset="/static/bc5412ec2cb771ce209bb170d2cd159d/91f87/castle.png 148w,
/static/bc5412ec2cb771ce209bb170d2cd159d/8335d/castle.png 295w,
/static/bc5412ec2cb771ce209bb170d2cd159d/8b3d4/castle.png 400w"
        sizes="(max-width: 400px) 100vw, 400px"
      />
  </span></p>
<p>The added dimension of an audience brings so much depth to playing around with sand. I wanted to facilitate this in sandspiel with the upload system.</p>
<h2>Building Sandspiel</h2>
<p>Sandspiel was (at least) my third go at building an interactive falling sand simulation.</p>
<p><a href="https://maxbittker.github.io/dust/">My early attempt</a> was pure javascript in 2015. It was slow, used canvas APIs, and was a disorganized mess of dynamic typing, switch statements, and global variables which made implementing and debugging each successive element’s logic increasingly difficult, to the point that it even resulted in bugs that I kept in the game, such as the “gitch” element. I was really proud of this game and had a great time building it, but it followed the familar arc of a system collapsing under its own weight as improving or refactoring became more difficult and motivation waned.</p>
<p><span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 506px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 99.40711462450594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAET0lEQVQ4yx2T209UVxTG98w5+773OTPnzDkOc2FGYJwBHK4DInfkZgRkKAjEC2CRAaGWys1CgBZHjBgL1lJMvZA0TW0abaKxFx/b2Jo+9qGPfe7f0TNN1tvea2V93+9bQBIh/YFwMOyBqiWZKbkUotDQ44assHiVzbr8stFv5nsEIURybnF+IeY/HjYDUgCTwHB5ZWx912xsP8IQIwgh2B5iSZsnDRL3snNRrcDSI14a5NBDsYrgQFDU+DlGCOhceLHiM82C8mrmNfxSEAxjXpz0sZBGDEoHj3oaAlJSqBEoCXIj3BGAPSGkQASYs6bkCACYSMqhiYJIvtvtKjFZT76WNFhQslNB2mBzBCHFkBMkBG8N8BqLKBgDziSBiqcsZSzdDp9OexiGSE1Zoi8ii02UsPS6PC1uYAghx1AXTEreFtL7IkaxSQFToRkKm6l6CwDmFFJVCE8FWG9IlHKlSLjSYV5qYPX/Zo0Rxmi5xc6GtRCHgCLi83rs4fddyWpKkPNDQTAuUXfyWHqgr/nkiZHiYD5TEM49OQURag/hej+jlOXWpgDkV6SOfLAuK2p1it0QNvvQ5pXh5c1bm1vZnZGmKHU5DHJrc0q5OBVkDX6EhQScUMcJ6nZ7XS4+tRw92eIGoNHCB0OtE1NXZ5Y+2riULpYuxJxm1dAFF+J8VKu1qSMEMN1gWKVCiPRF/+SCz/BQpFCoduTbMx/fWN24dtgRI6qLOxHAqtfhgnFDkPaHsKMAcO7wU8zS8kiyXLoAURWHh4PaJmj2wsjW9clij5OanFqKka47MYFVtij1cYMTwKlgRBWRKFUUSiHjlHHGHFcJDnhYoSlVpAoMVVUp9In97pjBeX+QFRs52wGDmLlVVFmPIwmKCXcD7gBzAaYAqioU5VLFKcYI2hoZqQrburbdkSwxSE6zsAPk8mj4s8G8B/N0aVOdv4VGpkRFJY1GEZVuqDiBcyZK6GYIOqkSjFZGg5bAQtdAsrdpaL/odFbrvwWtwyLl+x3y9Svvg588dx5bU31lnW0lNTUoXubWctKxAgjMDXQOxA7YYKW56vW5+LdD4YfjvsXp0ORiML1Sl9w617DdtnZx7FnL3oumOzfGrmQG2yI9Z49Wt9p5YRLIQ5j4iQs88a3/W3jtt9qeb068yHb/fr/r9S+p3e86Z54NtO70bfdmnl84/+dfiezfqbG5zMHy5U+uXsmcvNyfd6ZflifA7PEv3xa9GZx4nVj9GTx5WLDxQ2r+j/HzP64MvO388F396k712k7b9LuJ4X8q7y523qiu2lweWLg3MLsXGV8Ex0aXm7PTJZ+3FB1Ux/etkt3jTZ9einwxHNt6Gt2+PbLWPjdXltpttu5fHV2N3rwWi+2W1S0975p92p65CRqG39tbjjye82UXS76adR3MFbwaL1zYMDMbBYdjqUfjRS/TiTdp41GGvRj2/nrGd3dSm7243n79effCy/8ATHHRpBaqnEQAAAAASUVORK5CYII='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="dust"
        title=""
        src="/static/c8a9e0d02def97e788cce4d012a77f67/97f59/dust2.png"
        srcset="/static/c8a9e0d02def97e788cce4d012a77f67/1c747/dust2.png 148w,
/static/c8a9e0d02def97e788cce4d012a77f67/46b03/dust2.png 295w,
/static/c8a9e0d02def97e788cce4d012a77f67/97f59/dust2.png 506w"
        sizes="(max-width: 506px) 100vw, 506px"
      />
  </span></p>
<p>The <a href="https://github.com/MaxBittker/sand-toy">second approach</a> was in lua, and it evolved into my work on Sandspiel. A few things are briefly worth saying on this experience.
First I want to say that luajit is super fast, and <a href="https://love2d.org/">LÖVE</a> is an excellent tool for building games.
Shaders, input handling, update and render loops — pretty much everything clicked together and made life easy so I could get the game running quickly with minimal yak shaving and boilerplate.
Coming from the browser, a tool into which I have personally sunk <em>hundreds</em> of hours into learning APIs, edge cases, and optimizations, it was a surprise to see how simple and effective a minimal programming environment for building games could be.</p>
<p><span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/ElEQVQoz1VRTY/SYBDuNy3UtkChX/QDaKG2u+y20NJCuhhddxV3dVl148F4NxqNEkkQjMvVmzdP3vTkL/APePBP+dIiq09mJpOZ95nMPC8E/Q8CgXWObPB5DIGzCoaiFY5zDCO0bVvTOJqmCAIU4S0HBkAQkDwa1u/3VJnJdY1iRy+uyRhaYhhbMyLH7bZabr1eq1TyJAn40L98EP2W8Pzcu+0pb570ruulzVwwAoGukZhWrfYdx7MsnmFyOL5hsqxi6BOr4YO8zObaOk/nib9DqVbzQc97ZVknTlNLOnuBbYNDCAxbd4Erinp8/PH87LdpziAo2wdGUUYUz6Lox+npr/H4cxTc6TSNgbujC0KBJPGUvEGhgLnu6NbNT+32iaLYljX2/enh4ZfhcGqaHZrGaRKvC6ImCDRFETiOpBpld11dTxXYYkmtCi7LyukDOHWYwHAqR5Cp1FvmFfJkuS4f9XZXYe/rQfIz7n+X5YcUKWIonsm5/pMsy4CieZwyanznbsOZhsllMr5M7s2Tx9Pk2Sx5+nb04nU0eenFF+22QtObNbYYRt8uovksOlrF0bIfzgP/feAvAm8R7i+C/WWwuwz9D/1wNYjfdbsT09zheXS78556kEjlgVSNJGkgSbEkRWuTgcVpXCeyHIki6N5Q1VGtZnIckAtDkD/10EvaoPShlgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="lua"
        title=""
        src="/static/686c7962a802a57bc0fed007de9b049c/aeea7/lua.png"
        srcset="/static/686c7962a802a57bc0fed007de9b049c/a4403/lua.png 148w,
/static/686c7962a802a57bc0fed007de9b049c/18214/lua.png 295w,
/static/686c7962a802a57bc0fed007de9b049c/aeea7/lua.png 590w,
/static/686c7962a802a57bc0fed007de9b049c/011c8/lua.png 885w,
/static/686c7962a802a57bc0fed007de9b049c/3e8be/lua.png 1180w,
/static/686c7962a802a57bc0fed007de9b049c/95e26/lua.png 1770w,
/static/686c7962a802a57bc0fed007de9b049c/95727/lua.png 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span></p>
<p>Another important aspect of this new attempt to build a sand game was that I was coming into it with several years of experience beyond what I had when building the pure javascript version. I also had an important new goal - not only did I want the game to be fun to play, but I also wanted elements to be fun to <em>write</em>.</p>
<p>I came in with a focus on the ergonomics of defining elements with code because I was trying to build a sand game with a fully sandboxed programming interface that would allow people to not only share their compositions, but also to <em>code their own new elements</em> and share those!</p>
<p>My hope was that a community of people collaborating to build a plethora of weird elements would find really interesting design spaces that hadn’t been covered in other sand games.</p>
<p>However, the first step of this process was still building out a set of elements on my own. While building, I was thinking carefully about the needs of the element authors. Viewing the game engine as a public API meant designing it to move as much complexity as possible inside the engine and away from being the responsibility of the individual elements.</p>
<div class="gatsby-highlight" data-language="lua"><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">updateGas</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> getNeighbor<span class="token punctuation">,</span> setNeighbor<span class="token punctuation">)</span>
    <span class="token keyword">local</span> d <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">-- random location offset</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getNeighbor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">==</span> species<span class="token punctuation">.</span>empty<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token comment">-- if that relative location is empty</span>
        <span class="token function">setNeighbor</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> species<span class="token punctuation">.</span>empty<span class="token punctuation">)</span> <span class="token comment">-- write "empty" to my current location</span>
        <span class="token function">setNeighbor</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token comment">-- and write my particle type to the random offset</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>todo: make this paragraph make sense:</p>
<p>Making the definition of a new element as simple and self-contained as possible ultimately paid off an made the system a lot more fun to iterate on.</p>
<p>This meant defining a contract that elements had to follow — they’re a single update method which will be called by the system once per particle per frame, and they can interact with the system only via special methods which allow safe reading and writing to their neighbors. This API abstracts away concerns such as</p>
<ul>
<li>the absolute position of the particle in question (setNeighbor and getNeighbor deal in relative offsets),</li>
<li>observing limitations such as how far away an element is allowed to mutate or inspect other elements from (in this case, only their direct neighbors, no “action at a distance”)</li>
<li>and handling out of bounds accesses.</li>
</ul>
<p>This work relieved the individual elements from needing to take on these concerns into their own logic, and made the system more consistent and easier to experiment with as I implemented my set of elements.</p>
<p>Ultimately, I was excited about this approach, but wanted to build in a an environment that would be easy to share. Despite everything good I had to say about LÖVE, the web is too special of a platform to pass up for me, and it’s worth the difficulties imposed by its quirks and warts.</p>
<p>I decided to put down the lua implementation and switch to rust and web assembly, but I was able to translate many of the lessons and patterns over. Having a good idea of what my datastructures would be and what types of APIS would be defined between components made writing the rust version easier.</p>
<p>Implementing one idea multiple times was a huge strength in my ability to structure my codebase, forsee pitfalls, and make more intentional tradeoffs. <em>I would strongly recommend this experience to anyone</em> - If you have a project that you’ve attempted in the past but had to make compromises on due to your technical skills or endurance, taking another crack at it can a great opportunity to sweat the details and focus on aspects that you usually don’t.</p>
<h3>Architecture:</h3>
<p>The bulk of the simulation, including the movement and interactions of all of the elements, takes place in Rust in a class called Universe. This is class holds the game state and exposes a set of methods that get called by the javascript application, to do things like process a frame of the simulation, paint some pixels, or pass a pointer to the gamestate buffer.</p>
<p>This means that I don’t try to handle an event loop or interact with the browser from inside the Rust code - This is all perfectly possible, but I’m very happy with this division of labor between the JS and Rust. Everything low level or CPU intensive happens within the Rust-generated web assembly code, and all of the the glue related to human interface, WebGL calls, and browser APIs takes place in the javascript.</p>
<h4>Data format</h4>
<p>The state for a single particle is represented as a 32 bit struct.</p>
<div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[repr(C)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> Cell <span class="token punctuation">{</span>
    species<span class="token punctuation">:</span> Species<span class="token punctuation">,</span>
    ra<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>
    rb<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>
    clock<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The first field, species, is a custom type which represents the varieties of particles as numbers.</p>
<div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[wasm_bindgen]</span>
<span class="token attribute attr-name">#[repr(u8)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> Species <span class="token punctuation">{</span>
    Empty <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Wall <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    Sand <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    Water <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token punctuation">...</span>
    Seed <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">ra</code> and <code class="language-text">rb</code> are two 8 bit registers for storing extra cell state. They’re used in different ways by different element species, and some species don’t use them at all (for instance, Wall). The two state registers only differ in that ra is initialized to a random value, and rb is initialized to 0. Register A is also used in rendering to determine how light the pixel should be, which is where the slight visual noise comes from.</p>
<p><code class="language-text">clock</code> is used to avoid a single logical cell from being simulated multiple times in a single tick if it moves in the same direction as the update scans. Because we execute cell update functions one at a time from left to right and top to bottom, if a particle something is moving down, it will keep bumping itself ahead of the “scan line” and can move many spaces in a single frame. Clock is meant to keep track of what elements have been simulated already - this could have been accomplished single bit that is flipped back and forth but it’s important that my Cell type is represented by a total of 32 bits, and I didn’t have a use for the other 7 bits!</p>
<p>You may have noticed that nowhere in this cell state struct is a concept of location. This is because, as opposed to a particle simulation where we maintain a list of entities and their positions, here we store all particles in a dense 2D array, and directly encode the position of a cell as its location in that grid.</p>
<p><img src="/Data-6ccd0534956d56024fe025d5945162a4.svg" alt="data diagram"></p>
<h3>Update Function</h3>
<p>The most important pieces of code in the game are the functions that determine how each particle interacts with its neighbors each frame. Theoretically, you could delete the <code class="language-text">species.rs</code> file and write a new one that transforms the game into a cellular automata simulator for some other system, such an ant farm, a petri dish, a cityscape, a paint canvas, or an aquarium.</p>
<p>Here’s an example of how one of our elements is defined:</p>
<div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// Called once per sand particle per frame:</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">update_sand</span><span class="token punctuation">(</span>cell<span class="token punctuation">:</span> Cell<span class="token punctuation">,</span> <span class="token keyword">mut</span> api<span class="token punctuation">:</span> SandApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dx <span class="token operator">=</span> <span class="token function">rand_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// random value in {-1, 0, 1}</span>
    <span class="token keyword">let</span> neighbor <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get the Cell Struct of the cell below me</span>

    <span class="token keyword">if</span> neighbor<span class="token punctuation">.</span>species <span class="token operator">==</span> Species<span class="token punctuation">:</span><span class="token punctuation">:</span>Empty <span class="token punctuation">{</span> <span class="token comment">// try to fall down</span>
      api<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> EMPTY_CELL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// erase my current location</span>
      api<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cell<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// write myself one cell lower</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>species <span class="token operator">==</span> Species<span class="token punctuation">:</span><span class="token punctuation">:</span>Empty <span class="token punctuation">{</span> <span class="token comment">// try to fall diagonally</span>
      api<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> EMPTY_CELL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// erase my current location</span>
      api<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cell<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// write myself down and to the side</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre></div>
<p>SandApi a struct that holds the location of the element in a way that is transparent to the update function. It has two important functions: get and set, which accept relative coordinates and let you read and write to your neighboring cells. For instance, <code class="language-text">api.get(0, 1).species</code> tells you the species of the particle below you, and</p>
<div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust">api<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
   Cell <span class="token punctuation">{</span>
      species<span class="token punctuation">:</span> Species<span class="token punctuation">:</span><span class="token punctuation">:</span>Fire<span class="token punctuation">,</span>
      ra<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">150</span> <span class="token operator">+</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span>ra <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> u8<span class="token punctuation">,</span>
      rb<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      clock<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Will write a <code class="language-text">fire</code> particle to your current location (erasing yourself in the process).</p>
<p>Designing and tuning these update functions was a lot of fun, and I was able to test out a lot of ideas and play with different interactions. I didn’t make use of syntax macros or anything as fancy as that, but the experience was a lot like that of building a system by first building a “Domain Specific Language” which encodes the shared behaviors and invariants of the system, and then scripting its inhabitants in that simplified DSL.</p>
<p>One weak point that I didn’t elegantly solve in this design is that many of the elements have hardcoded inter-dependencies on each other. The best two examples are combustion and buoyancy. Several elements in the game have a shared behavior where they burn when exposed to fire or lava. Instead of being able writing some general purpose “flammability” behavior and compose that into the elements, each one manually checks its neighbors for being <code class="language-text">Species::Fire</code> or <code class="language-text">Species::Lava</code>, and reacts accordingly. This means that today I couldn’t add a “Spark” species which ignites flammable material without manually editing each of these update functions. I could have encoded some of this behavior into a shared helper function, or stored some global set of properties about each species besides their update functions.</p>
<p>Another thing to note here is that these update methods, which hold so much of the game logic, are run thousands of time per frame! This means that they’re simultaneously critical to the feel of the game, <em>and</em> are some of the hottest lines of code in the project. Rust’s commitment to enabling expressive, high level code without performance cliffs really allowed me to write the logic how I wanted to write it, without accidentally causing a bunch of slow heap allocation or writing code that a JIT will choose not to optimize. It’s probably possible that there are people out there who could craft some awesome high performance javascript that would be competitive with this Rust code, but I was able to mostly “just code” and not worry too much about performance cliffs. I didn’t even keep formal benchmarks.</p>
<p>Zero cost abstractions!</p>
<p>Last interesting anecdote here is that I unwittingly wrote most of the game with my rustc optimization strategy on “z”, which means optimize for binary size. Once the project was almost finished, I realized this and switched it to “o3” which does things like inlining and gave me a big performance boost, where I had been being frugal! That was a nice surprise.</p>
<h3>Rendering</h3>
<p>I mentioned that the simulation takes place in Web Assembly, and that the javascript manages the WebGL rendering (it is totally possible to make WebGL calls directly from web assembly, but I didn’t want to multiply my inexperience with WebGL with my inexperience in Rust). The shaders need to know the state of the game in order to visualize it - so we have to get bridge that gap!</p>
<p>In order to move the game state from Web Assembly to WebGL, we construct a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">Javascript typed array</a> <em>view</em> over the game state array which lives in Web Assembly memory, and pass that view to our fragment shader (GPU code) via a texture.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Typed Array is not a copy, it's a view of our web assembly array</span>
<span class="token keyword">const</span> cellsData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>
  memory<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span>
  universe<span class="token punctuation">.</span><span class="token function">cells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token comment">// a pointer to the Cell array in WASM</span>
  width <span class="token operator">*</span> height <span class="token operator">*</span> <span class="token number">4</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> cellTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
  width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
  cellsData
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Because our game state data is arranged in such a way that it happens to be a valid image texture, we can ship the whole thing over to the GPU with minimal repackaging and allocation! This was a big deal for making sandspiel’s rendering performant- our rendering code blocks the CPU for less than 1 millisecond, critical for meeting the strict 16ms budget needed to achieve 60FPS.</p>
<p><span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 72.94797687861272%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaklEQVQoz41R226bQBDl/z8jqtNWapM+9KUPVaXm0gRsE18SwMBizHUXFjDXXTDQwVHa14yORmcOZ86OhODYyNFlQ33U0WqHtjtzbeyfVWOto42O1qq+NKztDi01QwaDos9BBEUzngxrI9hot1fu0MutqS6QtkJTl9FOtrSFqcyROjdeJB/BKJnKo6mIprJA6tIEjyYLjudZPnZpciDEpbEbU4dSIE4UezSxo9hNEiBgsHG0x8SNEyfGIfXtYC+YlqbLF9rTBE+/ivbXqfMtOVxnzrd0wjSmB+jX1P5K7avM+ULd38+OTpujECX0IH02fl3YtzP/YUbEy0i6JGdg6QORZlicheIMLz7iOeBT+HgRKze0YDXrhawaN0H4XV0/RN5D7N0R7554f+LgMcFSSsSUQH85bFRLtPHmQLYWXh/igLVjzQeB5p2XlZsgVqNMDuk2TBScWgVf0+LGJQAJp1lRFkVZVk1Vs7wuwpzUbJiWo2PLed91Y9uNx6Zk7QkIb4eanYq6BZRNV8M7E4ZXkrCyZKdpGadNBZ9Zz9uxbYeGD0AAU1w7sLMCvTtN6d2UO9YNh2gYBUpp17bjOIZHjxRhyQuSh0Hm+plTsGIcxr7va16FRx8AYlonYAYxqagQkoimWRRHona/RBLyTdmYr+zFci961GGM1XWFk3BlLdf2UrZFCxuccRCNQBO8OCM0zvOcN+14GuCaoR/Gc0H86VxAxrcahuFVhKMEMLa51aXLmnESBr7nlVU5bY6QMfzfga03/FMEOKzKCQ9+1NXRC4IQh1Pq+0ooy6z0fna5wdu+gl/AGBzWv6/+Aj2iNtk5L4VZAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="sand-trace"
        title=""
        src="/static/fe3493b0c3e8612eb2fb13d5dc278815/aeea7/sand-trace.png"
        srcset="/static/fe3493b0c3e8612eb2fb13d5dc278815/a4403/sand-trace.png 148w,
/static/fe3493b0c3e8612eb2fb13d5dc278815/18214/sand-trace.png 295w,
/static/fe3493b0c3e8612eb2fb13d5dc278815/aeea7/sand-trace.png 590w,
/static/fe3493b0c3e8612eb2fb13d5dc278815/d3b29/sand-trace.png 865w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span></p>
<p>This is why it was so important that our Cell state was stored as an array of 4 byte chunks. WebGL has a lot of restrictions on the formats of data that can be used in textures, and these are even stricter on phones or older devices.</p>
<h3>Fluid Dynamics</h3>
<p>Sandspiel’s fluid simulation usually really stands out to people who play with it, which makes me feel a bit guilty, because it’s largely ripped from <a href="https://github.com/PavelDoGreat/WebGL-Fluid-Simulation">Pavel Dobryakov’s WebGL Navier-Stokes implementation</a>. I’m extremely grateful for such a high quality open codebase to learn from, and adapting this code was the most personally challenging technical hurdle I faced building the game.</p>
<p>Adapting the code was difficult because, in order to have interactions between the wind (simulated on the GPU) and the particles (simulated on the CPU), I needed to pass data from Web Assembly to WebGL, and from WebGL back into to Web Assembly.</p>
<p>I also needed to do this in a way that only used WebGL features available on phones - WebGl is a pretty complicated spec, and for hardware and driver reasons, not all of it is available on all devices.</p>
<p>The texture types they support required some munging, because the fluid simulation is done with floats, but to support phones I could only move data in or out of the shaders via unsigned byte textures)</p>
<p>There’s also a maximum # of simultaneously bound texture units of 8, and I had to plug a lot of gaps in my knowledge of how OpenGL works in order to correctly bind textures for each shader and stay under that limit.</p>
<p>All of this was made worse by the fact that my only phone to test code on runs iOS, and Apple only allows you to connect to the mobile safari devtools from a Mac. So I was debugging many of these WebGL device-specific limitations without so much as a console. Frustrating!</p>
<h3>User Interface</h3>
<p>I threw the interface together mostly in React. If you have one takeaway about Web Assembly from this project, I want it to be that wasm is not an all or nothing undertaking! The ability to put low-level and performance-critical logic into Rust and then handle browser stuff, glue code, and a high-quality UI in JS was critical to this project coming together quickly.</p>
<p>Leveraging the npm ecosystem for tools like React, Regl, and GLSLify, as well as exercising Javascript’s flexibility to throw data anywhere I needed it without planning or refactoring in order to validate ideas enabled me to go a lot further.</p>
<p>Nothing I wrote in JS would have been <em>impossible</em> to accomplish in rust, but it wouldn’t have come together as quickly and I wouldn’t have been able to test as many ideas along the way.</p>
<p>That being said, building high quality interfaces is something I value and respect, but I definitely phoned it in for this part of the codebase (if you want proof, read <code class="language-text">ui.js</code>) and the experience suffers for it. There are <em>still</em> a bunch of absent small touches like loading indicators, <em>proper routing</em>, visual feedback on buttons, pagination, etc. I was really itching to release the game and didn’t budget the time to do a better job. But I have no regrets. Building polished interfaces is my job, so it feels like work.</p>
<h3>Sharing &#x26; Persistence 1/3</h3>
<p>Knowing that I wanted some sort of social sharing functionality, I decided to try using Firebase to handle my backend needs. I think this worked out pretty well! One design decision that turned out to be important here was that I wanted to avoid dealing with accounts and authorization. I find that stuff annoying for the user and boring to implement so I went to some lengths to do without it.</p>
<p>The way that I handled data security without auth was putting all data writing inside of cloud function endpoints, and using these to constrain what the client could do. (basically, insert and vote only, no editing or deleting of other posts). My workaround for voting deduplication was to use IP addresses, which is possible to manipulate, but I don’t really care enough to try to fight it.</p>
<p>A cool thing here about the storage functionality is that I serialize the game state as a PNG file, which is compact and highly compressible. Plus, browsers have PNG encoders and decoders built in, so that’s more code I don’t need to import and ship with my bundle.
Here’s what the data looks like as a PNG: (remember, “red” is <code class="language-text">species</code>, “green” is <code class="language-text">ra</code>, and blue is <code class="language-text">rb</code>)
<span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 300px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAC8klEQVQ4y3VU21ITQRDdue1udjdXEnIjJCkJYLhrQAUpQUsFolVQglKlH+CD//96PJuZZBOJD1073Tt95nT3mfE8KeAJz5q3aCIvIWIBEXGdE1k85Fdm+2S+Dr1am/oeVJvB6hyYAzf7BZhhDE/TV9l/3XWgzletBMFhfQ6wtRzQH9ahVkOuJS1jaNYI6M8DhgiOqnOAjf8w3CrCtNv05UKJpuMAHWvdq5NhE14wBWwSsLIEcJBHeNqBUIWF3po+AdNk4wA7VYQveHA8D1h9OhRZNojGLSaKxXjkhhLbw1XTsOQyvPwUsJ4mu4S55qdJ6aQXDiJAMCpD19mzgt2v1yvwj2r/DGXFJZinTBdMaSSPA5heL5v6Wh7+XiUDTMuVRZeQW6LJqU5T9spH8rBLwGo25TZlc7ySAU4mpm2SKC8BVO6/a0PyYxO6HWcMO0UOb91JK21qVdsms1zRWrwFszY43Uk/RvJ9k5JKpjKhbArsa3Waxya/KrEPxjJcX5TOxNJp5t3aN2S4BzNahbdiDzLbRQQHfXiJtIDhxzUE564H2jESc9+EVsnKT+4H8K/y8Ab02XvdLyH3Zp97IwuYu2nBf1+1JUSOUQqc+qFjF1lf5ljy/RaCuwLkB8YoOdWrIP7agzCu5PCyieCWDPlIeLxWXs0B5G3CJJ4yLNHKCvHdNitqQ/S8iRZlI4foZpsMhWN43UX42IQ4FZBf2MdhmsxnqxRA7NM/4/qCMQIISiy+fQbzvGnZsxJZUwhPePVkkAJKou8hGNeY7EOMmXRky1bdCP5uF+oqgvjJ2BZtAtiH36/NZCSTALnzFq/kbCgNBL8KECcEO/RsKZyg2U0QXjegv2n4rzvQvK9iQyA3XkN4uMESlZVNrcTXpuZ6SMr6QcD/w7IeGTijHdA2CbwjIV/S2Ar9tgT1jtq74Ct+SVYjljckoxH3faL/mftSPZvfDBw74fIETSDNvmmWrXdYNp8q2bbSSV/p2a3y58zdMtVV+AsBWrx5OooqQwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="data"
        title=""
        src="/static/c0988162f298defbbfc77a1e811cb1e8/8fa6d/data.png"
        srcset="/static/c0988162f298defbbfc77a1e811cb1e8/a0c38/data.png 148w,
/static/c0988162f298defbbfc77a1e811cb1e8/1156b/data.png 295w,
/static/c0988162f298defbbfc77a1e811cb1e8/8fa6d/data.png 300w"
        sizes="(max-width: 300px) 100vw, 300px"
      />
  </span></p>
<p>The basic architecture is something like this:
<span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; text-decoration: none; background-image: none; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7ElEQVQoz21Sa0iTYRQ+21w1UcEfRZAXrF9djKxEo6bNzUsYFNJNxZih2TbTFrm06UinbkZp/rBEMgXtQsWcTrEIzbvTLC/DeUHdZm5m6iivmdtOfp/oD/HAy/PyPLzPeTjvAavVStPpdKBQKGCjOIFBwOVyGXmPs+xqG41O0uy8Q4XFFW7N6iFGRPgVxq2IixQ5IkU6gvTMcaRL+5BGvGueRQCL1QZikRBCeDIIFL+nEMLD9Ps71oCKqxrnua7L7YNVfkZTfeD00mDqA0JHOdD9UmtSfJMrtb7JyqEzaR9FBH8iqZIGiAhbK1t8kzCEXrXCfak/YdqijUbU83CqV/4C4I49oTEzGss5BWMYVGREprS5nOB8klV0CA0NdQwKCj7ADmC58CX5uwhBnnGPxDGNynV+UDZu7hPjv9FMXJ0okZMJyxxoLHmnN1PWmcSSd/A5T7p9N9OwhMV2BPpnfIk6effd2PHE18P+aTWvvPc42I9oql1nWi8YjZ9P4Vw7C/9okvPW7OCDB+y4oTQdkXesDIhVAz6uAE6hYeH7ORy2CzBztVTS+NHXEF9xbZW3SKkMyGrKPLbb3sE0Wr9v2fDyx8Loc8SfpWj9pSQTVsTupMuqp9xy6mefSd/2HxUD0PzDY+zYLDb5OcCWtcE2Rfne8sZjqoE1YVAdRHODF5q7E3MJgStJ2KuOjMivO39OMxzNHTHdTrhEjiIlhQqxxT3rprl94CUopR6OzKaWqzVk6v4upavFWKK3ThTacLYELVOKHIKPLshwbImKKqu7em15OCZmYZzHiyD40bg42mac05mtwMxqA2a2Gib7csn1MWhV7pNNYfMzTWfx77cQNPemFJJJkAEokTAwPd15USRyHhIIyK0wJCbC5trYbDby7unpCRZjKWmIyz1OS/3CosWeaMVib2zNiu7pdYI3NQupW+czxOOtXwiTDVMC+Xz+eoPf7dvNFfSfgslm4wIB6Hk8CnEM8fGkZljj/gPigV7bEZx6wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px none;"
        alt="firebase"
        title=""
        src="/static/5ed465bc7fe0daa71e86a0218eef7c86/aeea7/firebase.png"
        srcset="/static/5ed465bc7fe0daa71e86a0218eef7c86/a4403/firebase.png 148w,
/static/5ed465bc7fe0daa71e86a0218eef7c86/18214/firebase.png 295w,
/static/5ed465bc7fe0daa71e86a0218eef7c86/aeea7/firebase.png 590w,
/static/5ed465bc7fe0daa71e86a0218eef7c86/011c8/firebase.png 885w,
/static/5ed465bc7fe0daa71e86a0218eef7c86/2fb35/firebase.png 1150w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span></p>
<p>Firebase cloud functions worked really well to handle demand (average 2 requests per second on the peak day of the launch)</p>
<p>There were times when I was really just wished I was writing a http server with a redis instance and dumping the files into a directory. But I don’t want to be on the hook for DDoS and server management - especially when the other things running on my VPS are already fragile, stateful, and ad hoc. Firebase was harder to debug but I don’t have to think about it now that the service is deployed, and it’s cheap enough and reliable. Running the game for all of January cost about $15, and 99% of that was “firestore reads” which I haven’t tried to optimize for. I expect that at the current rate of traffic, it will be sustainable for me to keep running for quite a while.</p>
<h3>Community so far: 0/3</h3>
<p>SparkyKat
Belp
glitch liquid
js api</p>
<p>Thanks for reading!</p>
<h1>Resources to check out:</h1>
<p><a href="https://rustwasm.github.io/book/">The Rust Wasm Book</a> is a <em>great</em> succinct resource that covers all aspects of writing a hybrid JS &#x26; Rust application. I had basic rust knowledge before starting Sandspiel, but no knowledge of web assembly, and was able to follow this book to bootstrap the game. A lot of code from the book actually ended up in my game, since their example was cellular automota related.</p>
<p><a href="https://thebookofshaders.com/">The Book of Shaders</a> I didn’t specifically reference TBoS during this project, but I take any opportunity I can get to recommend it to anyone interested in learning graphics programming. I wish this book was a part of high school math curriculums.</p>
<p><a href="https://webglfundamentals.org/">WebGL Fundamentals</a> &#x26; <a href="https://webgl2fundamentals.org/">WebGL2 Fundamentals</a> Really solid &#x26; complete explanations of WebGL basics, put into context of common tasks and patterns. Finding those two things together is rare!</p>
<p><a href="http://developer.download.nvidia.com/books/HTML/gpugems/gpugems_ch38.html">Fast Fluid Dynamics Simulation on the GPU</a> is a chapter from the book <em>GPU Gems</em>, which details the math and mechanics that go into a beautiful and buttery Navier Stokes fluid simulation. It’s really interesting how physical concepts like pressure, advection, and diffusion, all expressed as math operations on grids of floats, can be composed into a convincing simulation.</p>
<p>Also, thanks to Chris Crawford, Nikhilesh Sigatapu, Thais Correia, Pavel Dobryakov, the Rust WebAssembly working group, and ha55ii for inspiration, knowledge, code, and feedback!</p>
<h1>Extra links:</h1>
<p><a href="https://github.com/MaxBittker/sandspiel">sandspiel source code</a></p>
<p><a href="https://simpleanalytics.io/sandspiel.club">sandspiel.club traffic statistics</a></p>
<p><a href="https://twitter.com/sandspiel_feed">@sandspiel_feed twitter feed of uploads</a></p></div><hr style="margin-bottom:1.65rem"/><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/code-review/">← <!-- -->How to Review Code You Don&#x27;t Understand</a></li><li><a rel="next" href="/post1/">Thinking about Color (WIP)<!-- --> →</a></li></ul></div></div></div></div></div></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-template-js","jsonName":"making-sandspiel-593","path":"/making-sandspiel"};window.dataPath="490/path---making-sandspiel-593-364-6J2jAgzFrUXlzycEQ7B8mrIdJZ8";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.e056beeb938d361a7bff.css","/app-d09068d80534b84825a4.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js.a60764a7020b2d0554a4.css","/component---src-templates-blog-template-js-ba78a60d3db701b00030.js"],"component---src-pages-index-js":["/component---src-pages-index-js.a60764a7020b2d0554a4.css","/component---src-pages-index-js-9ba0196963dfe964414b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-717ad55ec2640899869a.js"],"component---src-pages-about-js":["/component---src-pages-about-js.a60764a7020b2d0554a4.css","/component---src-pages-about-js-bfb31d192a9cacffacc5.js"],"component---src-pages-art-js":["/component---src-pages-art-js.a60764a7020b2d0554a4.css","/component---src-pages-art-js-48e4e97492af419880f7.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js.a60764a7020b2d0554a4.css","/component---src-pages-blog-js-46fc7ed1f86aa986a92c.js"],"component---src-pages-games-js":["/component---src-pages-games-js.a60764a7020b2d0554a4.css","/component---src-pages-games-js-52b1cd9e77217eaccc10.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js.a60764a7020b2d0554a4.css","/component---src-pages-projects-js-f28c085c452dcbfbc7b0.js"],"pages-manifest":["/pages-manifest-73b51a1b5011e84222e8.js"]};/*]]>*/</script><script src="/webpack-runtime-109b3e4f4849cb0c05d9.js" async=""></script><script src="/app-d09068d80534b84825a4.js" async=""></script><script src="/component---src-templates-blog-template-js-ba78a60d3db701b00030.js" async=""></script></body></html>